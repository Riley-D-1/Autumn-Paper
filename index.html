<!DOCTYPE html>
<html lang = "en">
<head>
    <meta name = "viewport" content="width=device-width, initial-scale=1.0">
    <title>Autumn Wallpaper</title>
    <link rel = "stylesheet" href = "style.css">
</head>
<body>
    <canvas id = "wallpaper_window" width = "window.innerWidth" height = "window.innerHeight"></canvas>
</body>
<script>
    const bg_image = new Image()
    bg_image.src = 'assets/wallpaper_bg.png'
    const canvas = document.getElementById("wallpaper_window")
    const ctx = canvas.getContext("2d")
    canvas.width = window.innerWidth
    canvas.height = window.innerHeight
    let leaves_pos = []
    // Width= 911 (1080p width), current img scaling now good :D but leaving here for debugging
    function create_leaf(last_leaf){
        let x_pos_start = Math.floor(Math.random()*1920)
        let y_val_start;
        if (x_pos_start < 450 || x_pos_start > 1440) {
            y_val_start = -50;
        } else {
            y_val_start = 525;
        }
        let flipped_
        if (Math.random() < 0.5){
            flipped_ = true
        }else{
            flipped_ = false
        }
        // Randomises the start strength of wind drift
        random_idk = Math.random()
        if (random_idk < 0.8){
            drift_direction_start = "right"
        }else if (random_idk < 0.8){
            drift_direction_start = "right_str"
        }else{
            drift_direction_start = "down"
        }
        // Sets the start vals to push into a list of all known leaves
        start_vals = {
            "y_val": y_val_start,
            "x_val": x_pos_start,
            "x_pos_start": x_pos_start,
            "creation_time": Date.now(),
            "flipped_": flipped_,
            "drift_dir": drift_direction_start
        }
        leaves_pos.push(start_vals);
    }

    function leaf_drift(leaf,leaf_num){
        let leaf_x_pos = leaf["x_val"]
        let leaf_y_pos = leaf["y_val"]
        let leaf_x_pos_start = leaf["x_pos_start"]
        let leaf_creation_time = leaf["creation_time"]
        let caculated_y_pos = leaf_y_pos + 1
        let caculated_x_pos = leaf_x_pos
        let flipped = leaf["flipped_"] 
        let leaf_drift = leaf["drift_dir"]
        // Check if the drift direction is down 
        if (leaf_drift === "right"){
            let random_num = Math.random()
            if (random_num > 0.999){
                leaf["drift_dir"]  = "down"
            }
        }else if (leaf_drift === "right_major"){
            let random_2 = Math.random()
            // Random 2 bogaloo
            if (random_2 > 0.999){
                leaf["drift_dir"]  = "right"
            }
        }
        // YES THIS IS A HORRENDOUS IF BLOCK BUT IDK MAN it works
        // WE DONT TOUCH IT BECUASE IT WORKS :D
        // It just checks if its hitting the tree or not and then does the drifting caculations

        if (caculated_y_pos < 525) {
            if (caculated_x_pos > 440 && caculated_x_pos < 1450) {
            } else {
                if (leaf["drift_dir"] === "right") {
                    caculated_x_pos += 0.5;
                }else if (leaf["drift_dir" === "right_str"])
                    caculated_x_pos += 2;
            }
        } else {
            if (leaf["drift_dir"] === "right") {
                caculated_x_pos += 0.5;
            }else if (leaf["drift_dir" === "right_str"])
                    caculated_x_pos += 2;
        }
        leaf["x_val"] = caculated_x_pos;
        leaf["y_val"] = caculated_y_pos;
        leaf["flipped"] = flipped
        return [flipped,caculated_y_pos,caculated_x_pos]
    }
    // Note that yes it would be easier doing pixel art externally and importing them for the leaves
    //  but that doesn't count for time and this is an intreasting challenge
    //  and I just need to finish the 6 hours of this week on a simple project
    function draw_leaf(flipped,y_pos,x_pos){
        const orange_1 = "#ff4f17" //Changed my mind orignal was best lol
        // just have to deal with overlap in leaf drift
        ctx.fillStyle = orange_1
        if (flipped === false){
            ctx.fillRect(x_pos,(y_pos+2),10,10)
            ctx.fillRect((x_pos+5),(y_pos+8),10,10)
            ctx.fillRect((x_pos+5),(y_pos+15),15,5)
        }else{
            ctx.fillRect(x_pos,(y_pos+2),10,10)
            ctx.fillRect((x_pos-5),(y_pos+8),10,10)
            ctx.fillRect((x_pos-10),(y_pos+15),15,5)
        }
    }

    function draw_tree(){
        // Credit to those in inspo folder but my own pixel art :D
        ctx.drawImage(bg_image, 0, 0, canvas.width, canvas.height)
    }

    function main_function(){
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        draw_tree()
        let temp_rand_num = Math.random()
        if (temp_rand_num > 0.975){
            create_leaf()
            // Maybe ensure no overlap somehow?
        }
        index = 0
        leaves_pos.forEach((leaf, index) => {
            let leaf_num = index
            // to ensure leaves are deleted after they drift off the screen. 
            // Otherwise it would eventually crash from the leaves drifting into the aether lol
            if (leaf["y_val"] < (-1.05 * canvas.height)){
                leaves_pos.splice(index, 1);
            }
            let returned_vals= leaf_drift(leaf,leaf_num)
            let flipped = returned_vals[0]
            let x_pos = returned_vals[1]
            let y_pos = returned_vals[2]
            index+=1
            draw_leaf(flipped,x_pos,y_pos)
        });
    }

    // What triggers the main seequence
    setInterval(() => {
            main_function()
    }, 11)
    // Changed my mind for the 50th time made clicks work for the website people (note that clicks dont work in lively)
    document.addEventListener("click", function(event) {
        for (let index = 0; index < 4; index++) {
            create_leaf()  
        }
    });
    // 11 ms wait time (this compounds quite quickly so all of the leave
    //creation functionality is at ridiculously rare chances
    // This is also the case for the leaf drift as well
</script>
