<!DOCTYPE html>
<html lang = "en">
<head>
    <meta name = "viewport" content="width=device-width, initial-scale=1.0">
    <title>Wallpaper</title>
    <link rel = "stylesheet" href = "style.css">
</head>
<body>
    <canvas id = "wallpaper_window" width = "window.innerWidth" height = "window.innerHeight"></canvas>
</body>
<script>
    const bg_image = new Image()
    bg_image.src = 'assets/wallpaper_bg.png'
    const canvas = document.getElementById("wallpaper_window")
    const ctx = canvas.getContext("2d")
    canvas.width = window.innerWidth
    canvas.height = window.innerHeight
    let leaves_pos = []
    // Width= 911 (1080p width), current img scaling now good :D but leaving here 
    // random number (now need to make it correlate with starting postion)
    // Have to make natural
    // Note that yes it would be easier doing pixel art externally and importing them for the leaves
    //  but that doesn't count for time and this is an intreasting challenge
    //  and I just need to finish the 6 hours of this week on a simple project who's scale can be reduced or expanded
    function create_leaf(last_leaf){
        // Need to make this work with other values 
        // 450 -  1440 is the bounds of x (move all vals in here to y = 525 ) (turn to %)
        // Need to ensure that the caculated breezes dont cross here before y >= 525
        let x_pos_start = Math.floor(Math.random()*1920)
        // FORGOT ABOUT WHILE LOOPS
        //while (x_pos_start > 450 || x_pos_start < 1440){
        //}
        // WORKING just maybe modify the values so there is less emptiness?
        let y_val_start;
        if (x_pos_start < 450 || x_pos_start > 1440) {
            y_val_start = -50;
        } else {
            y_val_start = 525;
        }
        let flipped_
        if (Math.random() < 0.5){
            flipped_ = true
        }else{
            flipped_ = false
        }
        random_idk = Math.random()
        if (random_idk < 0.8){
            drift_direction_start = "right"
        }else{
            drift_direction_start = "down"
        }
        start_vals = {
            "y_val": y_val_start,
            "x_val": x_pos_start,
            "x_pos_start": x_pos_start,
            "creation_time": Date.now(),
            "flipped_": flipped_,
            "drift_dir": drift_direction_start
        }
        leaves_pos.push(start_vals);
    }
    function leaf_drift(leaf,leaf_num){
        let leaf_x_pos = leaf["x_val"]
        let leaf_y_pos = leaf["y_val"]
        let leaf_x_pos_start = leaf["x_pos_start"]
        let leaf_creation_time = leaf["creation_time"]
        let caculated_y_pos = leaf_y_pos + 1
        let caculated_x_pos = leaf_x_pos
        let flipped = leaf["flipped_"] 
        let leaf_drift = leaf["drift_dir"]
        // Need to code breeze chances
        // Give it a chance of major wind drift
        // Need to improve chances
        if (leaf_drift === "right"){
            let random_num = Math.random()
            if (random_num > 0.999){
                leaf["drift_dir"]  = "down"
            }
        }
        // YES THIS IS A HORRENDOUS IF BLOCK BUT IDK MAN it works
        // Drift if true 
        
        if (caculated_y_pos < 525 && caculated_y_pos < 500){
            if (caculated_x_pos > 450 && caculated_x_pos < 1450){
                //pass because of tree
            }else{
                if (leaf_drift === "right"){
                    caculated_x_pos +=1            
                }
            }
        }else if (caculated_y_pos < 300){
            if (caculated_x_pos > 450 && caculated_x_pos < 1450){
                if (leaf_drift === "right"){
                    caculated_x_pos +=1            
                }   
            }
        }
        // WHYYYY
        // Got AI to build me a function and its like the same but it looks nice? 
        leaf["x_val"] = caculated_x_pos;
        leaf["y_val"] = caculated_y_pos;
        leaf["flipped"] = flipped
        return [flipped,caculated_y_pos,caculated_x_pos]
    }

    function draw_leaf(flipped,y_pos,x_pos){
        const orange_1 = "#ff4f17" //Changed my mind orignal was best lol
        ctx.fillStyle = orange_1
        if (flipped === false){
            ctx.fillRect(x_pos,(y_pos+2),10,10)
            ctx.fillRect((x_pos+5),(y_pos+8),10,10)
            ctx.fillRect((x_pos+5),(y_pos+15),15,5)
        
        }else{
            ctx.fillRect(x_pos,(y_pos+2),10,10)
            ctx.fillRect((x_pos-5),(y_pos+8),10,10)
            ctx.fillRect((x_pos-10),(y_pos+15),15,5)
        }
    }

    function draw_tree(){
        // Credit to those in inspo folder but my own pixel art :D
        ctx.drawImage(bg_image, 0, 0, canvas.width, canvas.height)
    }

    function main_function(){
        ctx.clearRect(0, 0, canvas.width, canvas.height);
        draw_tree()
        let temp_rand_num = Math.random()
        if (temp_rand_num > 0.975){
            create_leaf()
            // Maybe ensure no overlap somehow?
        }
        index = 0
        leaves_pos.forEach((leaf, index) => {
            let leaf_num = index
            // to ensure leaves are deleted
            if (leaf["y_val"] < (-1.05 * canvas.height)){
                leaves_pos.splice(index, 1);
            }
            let returned_vals= leaf_drift(leaf,leaf_num)
            let flipped = returned_vals[0]
            let x_pos = returned_vals[1]
            let y_pos = returned_vals[2]
            index+=1
            draw_leaf(flipped,x_pos,y_pos)
        });
    }
    // What triggers the main seequence
    setInterval(() => {
            main_function()
    }, 11)
    document.addEventListener("click", function(event) {
        // debuging statement
        console.log(`X = ${event.clientX} ,  Y = ${event.clientY}`);
    });
    // Click will be left as debugging statement
    // Clcik functionality did not work on lively for some reason so now removed
    // full efforts will be focused on randomness of leaves and breeze
</script>
